name: ab-${ENVIRONMENT}

include:
  - docker-compose.platform.yml

services:
  backbone:
    build:
      context: .
      dockerfile: apps/backbone/Dockerfile
    restart: unless-stopped
    environment:
      TZ: America/Sao_Paulo
      NODE_ENV: production
      BACKBONE_PORT: ${BACKBONE_PORT}
      CONTEXT_FOLDER: ./context
      JWT_SECRET: ${JWT_SECRET}
      SYSUSER: ${SYSUSER}
      SYSPASS: ${SYSPASS}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
      EVOLUTION_URL: http://evolution.internal:8080
      EVOLUTION_API_KEY: ${EVOLUTION_API_KEY}
      EVOLUTION_INSTANCE_NAME: ${EVOLUTION_INSTANCE_NAME}
    volumes:
      - ./context:/app/context
      - ./data:/app/apps/backbone/data
    networks:
      internal:
        aliases:
          - backbone.internal
      web_network:

  hub:
    build:
      context: .
      dockerfile: apps/hub/Dockerfile
    restart: unless-stopped
    depends_on:
      - backbone
    volumes:
      - ./apps/hub/nginx.prod.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      internal:
      web_network:

networks:
  web_network:
    external: true
