# AI SDK — Better AI (Milestone 01)
## Agent Harness Progress

---

## Current Status

**Phase:** COMPLETE — All 13 features passing.
**Features:** 13/13 (all passing)
**Build:** Compilando (18 tools — 6 existentes + 12 novas + AiAgentEvent types expansion)

---

## Specs Path

```
milestones/01-better-ai/PRP.md
```

---

## Environment

- **Stack:** Node.js (ESM), Vercel AI SDK v4, Zod v3, OpenRouter
- **Package manager:** npm (workspaces monorepo)
- **Build:** `npm run build --workspace=packages/ai-sdk` (tsc)
- **Dev:** `npm run dev` (tsc --watch) no workspace ai-sdk
- **No tests:** Projeto nao tem framework de testes configurado

---

## Features

- [x] F-001: AiAgentEvent types expansion (priority 1) ✓ 2026-02-16
- [x] F-002: T08 — ListDir tool (priority 2) ✓ 2026-02-16
- [x] F-003: T07 — MultiEdit tool (priority 3) ✓ 2026-02-16
- [x] F-004: T05+T06 — TodoWrite + TodoRead tools (priority 4, depends: F-001) ✓ 2026-02-16
- [x] F-005: T09 — Diagnostics tool (priority 5) ✓ 2026-02-16
- [x] F-006: T01 — AskUser tool (priority 6, depends: F-001) ✓ 2026-02-16
- [x] F-007: T02 — WebFetch tool (priority 7) ✓ 2026-02-16
- [x] F-008: T03 — WebSearch tool (priority 8) ✓ 2026-02-16
- [x] F-009: T04 — Task sub-agente tool (priority 9) ✓ 2026-02-16
- [x] F-010: T10 — Batch tool (priority 10) ✓ 2026-02-16
- [x] F-011: T11 — ApplyPatch tool (priority 11) ✓ 2026-02-16
- [x] F-012: T12 — CodeSearch tool (priority 12) ✓ 2026-02-16
- [x] F-013: Tool registry final + build validation (priority 13, depends: all) ✓ 2026-02-16

---

## Architecture Decisions

1. **Padrao de tool:** Todas as novas tools seguem o mesmo padrao das 6 existentes — arquivo `.ts` em `src/tools/`, exportando `tool()` do Vercel AI SDK com schema Zod.
2. **Novos eventos:** `ask_user` e `todo_update` adicionados ao tipo `AiAgentEvent` em `src/types.ts`.
3. **Estado de sessao:** TodoWrite/TodoRead compartilham estado em memoria (closure ou modulo-level).
4. **Providers plugaveis:** WebSearch e CodeSearch nao hardcodam providers — recebem via AiAgentOptions ou factory.
5. **AskUser callback:** Mecanismo de pergunta ao usuario via callback injetavel (nao polling).
6. **Sub-agente fire-and-forget:** Task lanca `runAiAgent()` internamente, sem coordenacao bidirecional.
7. **Atomicidade MultiEdit:** Todas edicoes validadas antes de aplicar qualquer uma.
8. **Batch sem recursao:** Batch dentro de Batch e rejeitado.
9. **Output limit:** Ferramentas respeitam 50KB max output.
10. **ESM-only:** Imports com extensao `.js`, sem CommonJS.
11. **Tool count:** PRP header dizia 6→15=9 novas, mas PRP body detalha 12 ferramentas (T01-T12). Total correto: 18.

---

## Session Notes

Session 1 (Initializer): Harness criado para milestone 01-better-ai
Session 2 (Coding Agent): F-001 AiAgentEvent types expansion
Session 3 (Coding Agent): F-002 ListDir tool
Session 4 (Coding Agent): F-003 MultiEdit tool
Session 5 (Coding Agent): F-004 TodoWrite + TodoRead tools
Session 6 (Coding Agent): F-005 Diagnostics tool
Session 7 (Coding Agent): F-006 AskUser tool
Session 8 (Coding Agent): F-007 WebFetch tool
Session 9 (Coding Agent): F-008 WebSearch tool
Session 10 (Coding Agent): F-009 Task sub-agent tool
Session 11 (Coding Agent): F-010 Batch tool
Session 12 (Coding Agent): F-011 ApplyPatch tool
Session 13 (Coding Agent): F-012 CodeSearch tool

Session 14 (Coding Agent): F-013 Tool registry final + build validation
- Verified codingTools exports exactly 18 tools (6 existing + 12 new)
- Verified all 6 existing tools (Read, Write, Edit, Bash, Glob, Grep) present and unchanged
- Verified all 12 new tools present: ListDir, MultiEdit, TodoWrite, TodoRead, Diagnostics, AskUser, WebFetch, WebSearch, Task, Batch, ApplyPatch, CodeSearch
- Verified AiAgentEvent includes ask_user and todo_update types
- Verified all SDK exports from src/index.ts (runAiAgent, factory functions, types)
- Verified agent.ts properly overrides pluggable tools (AskUser, WebSearch, CodeSearch, Task, Batch)
- Build passes: npm run build --workspace=packages/ai-sdk (zero errors)
- Consumer validation: npm run build --workspace=apps/backbone (zero errors)
- Programmatic smoke test confirmed all tools load and are structurally valid
- PRP tool count discrepancy resolved: PRP summary said 15, PRP body defines 12 new (T01-T12), total is 18
- Milestone 01-better-ai is COMPLETE

---

## Milestone Complete

All 13 features implemented and validated. The AI SDK now has 18 coding tools covering filesystem operations, web access, user interaction, sub-agents, batch execution, patching, and code search — closing the competitive gap with Claude Code, OpenCode, and Codex CLI.
