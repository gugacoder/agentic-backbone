[
  {
    "id": "F-001",
    "name": "telemetry-types",
    "description": "Criar KaiTelemetryOptions interface e adicionar campo telemetry? em KaiAgentOptions em types.ts",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 1,
    "tests": [
      "KaiTelemetryOptions existe em types.ts com campos: enabled (boolean), functionId? (string), metadata? (Record<string,string>)",
      "KaiAgentOptions tem campo telemetry?: KaiTelemetryOptions",
      "KaiTelemetryOptions é exportada em index.ts",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-002",
    "name": "usage-step-breakdown",
    "description": "Estender KaiUsageData com campos opcionais timeToFirstTokenMs e steps[] para breakdown por step",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 2,
    "tests": [
      "KaiUsageData tem campo timeToFirstTokenMs?: number",
      "KaiUsageData tem campo steps?: Array<{ stepNumber: number; toolCalls: string[]; inputTokens: number; outputTokens: number; durationMs: number }>",
      "Campos são opcionais (não quebram consumidores existentes)",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-001"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-003",
    "name": "peer-dependency-otel",
    "description": "Adicionar @opentelemetry/api como peerDependency opcional no package.json da kai-sdk",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 3,
    "tests": [
      "package.json tem peerDependencies com '@opentelemetry/api': '^1'",
      "package.json tem peerDependenciesMeta com '@opentelemetry/api': { optional: true }",
      "@opentelemetry/api NÃO aparece em dependencies nem devDependencies",
      "npm run build --workspace=packages/kai-sdk compila sem erros (sem @opentelemetry/api instalado)"
    ],
    "dependencies": [],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-004",
    "name": "telemetry-in-streamtext",
    "description": "No agent.ts, mapear options.telemetry para experimental_telemetry do Vercel AI SDK no streamText(). Incluir sessionId, model, e metadata customizada nos spans.",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 4,
    "tests": [
      "streamText() recebe experimental_telemetry quando options.telemetry?.enabled === true",
      "experimental_telemetry.isEnabled é true",
      "experimental_telemetry.functionId usa options.telemetry.functionId ou fallback 'kai-agent'",
      "experimental_telemetry.metadata inclui sessionId e model do options",
      "experimental_telemetry.metadata inclui spread de options.telemetry.metadata",
      "Quando telemetry não é fornecido ou enabled é false, experimental_telemetry é undefined",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-001"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-005",
    "name": "telemetry-in-compaction",
    "description": "No compaction.ts, propagar telemetry options para generateObject() e generateText() usados na compactação, emitindo spans de compaction.",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 5,
    "tests": [
      "CompactOptions tem campo telemetry?: KaiTelemetryOptions",
      "generateObject() e generateText() recebem experimental_telemetry com functionId 'kai-compaction' quando telemetria habilitada",
      "agent.ts passa options.telemetry para compactMessages()",
      "Quando telemetry não é fornecido, compactação funciona identicamente ao atual",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-001",
      "F-004"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-006",
    "name": "session-span",
    "description": "Criar span pai 'kai.agent.run' que engloba toda a execução de runKaiAgent(), com atributos session_id, model, max_steps. Emitir warning se @opentelemetry/api não estiver disponível.",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 6,
    "tests": [
      "Quando telemetry.enabled é true e @opentelemetry/api está disponível, um span 'kai.agent.run' é criado com tracer 'kai-sdk'",
      "Span tem atributos: kai.session_id, kai.model, kai.max_steps",
      "Span é finalizado com span.end() no bloco finally",
      "Quando telemetry.enabled é true mas @opentelemetry/api NÃO está instalado, console.warn é emitido e execução prossegue normalmente",
      "Quando telemetry não está habilitado, nenhum span é criado (zero overhead)",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-003",
      "F-004"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-007",
    "name": "step-data-collection",
    "description": "Coletar dados de steps (toolCalls, tokens, duração) via onStepFinish e popular KaiUsageData.steps no evento usage final.",
    "status": "passing",
    "completed_at": "2026-02-17",
    "priority": 7,
    "tests": [
      "onStepFinish registra dados por step: stepNumber, toolCalls, durationMs",
      "Quando telemetria habilitada, usage event inclui steps[] com breakdown completo",
      "Cada step em steps[] tem: stepNumber, toolCalls, inputTokens, outputTokens, durationMs",
      "Sem telemetria, steps é undefined no usage event (backward compatible)",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-002",
      "F-004"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\09-kai-telemetry\\PRP.md"
  },
  {
    "id": "F-008",
    "name": "build-verification",
    "description": "Verificação final: build limpo, exports corretos, zero breaking changes nos tipos existentes.",
    "status": "failing",
    "priority": 8,
    "tests": [
      "npm run build --workspace=packages/kai-sdk compila sem erros",
      "index.ts exporta KaiTelemetryOptions",
      "Todos os campos novos em KaiUsageData são opcionais (?:)",
      "KaiAgentOptions.telemetry é opcional (?:)",
      "Sem @opentelemetry/api instalado, build compila normalmente",
      "Nenhum import direto de @opentelemetry/api no nível top-level (apenas dynamic import)"
    ],
    "dependencies": [
      "F-001",
      "F-002",
      "F-003",
      "F-004",
      "F-005",
      "F-006",
      "F-007"
    ]
  }
]
