[
  {
    "id": "F-001",
    "name": "backbone-response-helpers",
    "description": "Criar helpers ok(), fail() e proxyGet() em routes.ts para padronizar todas as respostas como HTTP 200 com envelope { ok, data } ou { ok, error }. Refatorar actionResultToResponse() para usar os novos helpers.",
    "status": "passing",
    "priority": 1,
    "completed_at": "2026-02-17T14:30:00Z",
    "tests": [
      "Helper ok(c, data) retorna HTTP 200 com body { ok: true, data }",
      "Helper fail(c, error, details, extra) retorna HTTP 200 com body { ok: false, error, details, ...extra }",
      "Helper proxyGet(c, url, apiKey, errorCode) retorna ok() no sucesso e fail() na falha",
      "actionResultToResponse retorna HTTP 200 para todos os cenarios (cooldown, exhausted, erro generico)"
    ],
    "dependencies": [],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-002",
    "name": "backbone-routes-envelope",
    "description": "Migrar TODAS as rotas do modulo Evolution (GET /instances, GET /instances/:name, POST /instances, DELETE /instances/:name, GET /instances/:name/qr, GET /instances/:name/settings, PATCH /instances/:name/settings, POST reconnect, POST restart) para retornar HTTP 200 com envelope padronizado usando ok()/fail(). Nenhuma rota deve retornar 4xx/5xx exceto falha de rede real.",
    "status": "passing",
    "priority": 2,
    "completed_at": "2026-02-17T18:00:00Z",
    "tests": [
      "GET /instances com API offline retorna 200 { ok: false, error: 'api_offline' }",
      "GET /instances com API online retorna 200 { ok: true, data: [...] }",
      "GET /instances/:name com instancia inexistente retorna 200 { ok: false, error: 'instance_not_found' }",
      "POST /instances com sucesso retorna 200 { ok: true, data: {...} } (nao 201)",
      "POST /instances com falha retorna 200 { ok: false, error: 'create_failed', details: ... }",
      "DELETE /instances/:name com falha retorna 200 { ok: false, error: 'delete_failed', details: ... }",
      "GET /instances/:name/qr com falha retorna 200 { ok: false, error: 'qr_unavailable', details: ... }",
      "GET /instances/:name/settings com falha retorna 200 { ok: false, error: 'settings_fetch_failed', details: ... }",
      "PATCH /instances/:name/settings com falha retorna 200 { ok: false, error: 'settings_update_failed', details: ... }",
      "POST reconnect com cooldown retorna 200 { ok: false, error: 'cooldown_active', retryAfterMs: N }",
      "POST reconnect com exhausted retorna 200 { ok: false, error: 'retries_exhausted', attempts: N, maxRetries: N }",
      "POST restart segue o mesmo padrao de reconnect"
    ],
    "dependencies": [
      "F-001"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-003",
    "name": "hub-api-types",
    "description": "Adicionar tipo ApiResult<T> em api/evolution.ts (interface com ok, data?, error?, details?, retryAfterMs?, attempts?, maxRetries?). Adicionar mapa de mensagens amigaveis (error code -> mensagem pt-BR) e helper friendlyMessage().",
    "status": "passing",
    "priority": 3,
    "completed_at": "2026-02-17T18:15:00Z",
    "tests": [
      "Interface ApiResult<T> exportada de api/evolution.ts com campos ok, data?, error?, details?, retryAfterMs?, attempts?, maxRetries?",
      "Mapa de mensagens amigaveis cobre todos os error codes: api_offline, instance_not_found, create_failed, delete_failed, qr_unavailable, cooldown_active, retries_exhausted, settings_fetch_failed, settings_update_failed, network_error",
      "friendlyMessage('api_offline') retorna 'Evolution API esta indisponivel'",
      "friendlyMessage('codigo_desconhecido') retorna mensagem fallback generica"
    ],
    "dependencies": [],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-004",
    "name": "hub-queries-envelope",
    "description": "Refatorar todas as queryFn em api/evolution.ts para interpretar o envelope ApiResult<T>. Queries devem extrair data quando ok=true, retornar valor vazio/default quando ok=false (sem lancar erro). isError do React Query deve indicar apenas falha de rede (backbone inacessivel).",
    "status": "passing",
    "priority": 4,
    "completed_at": "2026-02-17T21:00:00Z",
    "tests": [
      "evolutionInstancesQuery retorna array vazio quando resultado eh { ok: false }",
      "evolutionInstanceQuery retorna null/undefined quando resultado eh { ok: false }",
      "evolutionInstanceSettingsQuery retorna null quando resultado eh { ok: false }",
      "evolutionInstanceQRQuery retorna null quando resultado eh { ok: false }",
      "evolutionHealthQuery continua funcionando normalmente (rota /health nao usa envelope)",
      "Nenhuma queryFn lanca erro por erro de negocio — isError so dispara por falha de rede"
    ],
    "dependencies": [
      "F-003"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-005",
    "name": "hub-mutations-envelope",
    "description": "Refatorar todas as mutations em api/evolution.ts para retornar ApiResult<T>. Os handlers onSuccess nos componentes devem verificar result.ok antes de proceder. Erros de negocio mostram toast via friendlyMessage(), sem entrar em onError.",
    "status": "passing",
    "priority": 5,
    "completed_at": "2026-02-17T23:00:00Z",
    "tests": [
      "useCreateInstance retorna ApiResult — onSuccess verifica result.ok",
      "useDeleteInstance retorna ApiResult — onSuccess verifica result.ok",
      "useReconnectInstance retorna ApiResult — onSuccess verifica result.ok e trata cooldown/exhausted",
      "useRestartInstance retorna ApiResult — onSuccess verifica result.ok e trata cooldown/exhausted",
      "useUpdateInstanceSettings retorna ApiResult — onSuccess verifica result.ok",
      "Erros de negocio (ok: false) geram toast com mensagem amigavel, nao entram em onError"
    ],
    "dependencies": [
      "F-003"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-006",
    "name": "hub-create-dialog-separation",
    "description": "Refatorar create-instance-dialog.tsx: ao criar com sucesso, navegar para aba 'status' (nao 'qr'). Quando result.ok === false, mostrar toast com mensagem amigavel e manter dialog aberto.",
    "status": "passing",
    "priority": 6,
    "completed_at": "2026-02-17T23:30:00Z",
    "tests": [
      "Apos criacao com sucesso, navigate vai para tab: 'status' (nao 'qr')",
      "Quando result.ok === false, dialog permanece aberto",
      "Quando result.ok === false, toast exibe mensagem amigavel via friendlyMessage(result.error)",
      "Quando result.ok === false, form nao eh resetado"
    ],
    "dependencies": [
      "F-005"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-007",
    "name": "hub-whatsapp-page-no-error-state",
    "description": "Refatorar whatsapp.tsx para nunca renderizar tela de erro por erro de negocio. Se instances retornar array vazio (quando ok: false ou dados vazios), mostrar estado vazio na tabela. Remover dependencia de isError para renderizar InstanceTable — a tabela sempre renderiza.",
    "status": "passing",
    "priority": 7,
    "completed_at": "2026-02-17T23:45:00Z",
    "tests": [
      "Quando query retorna array vazio, InstanceTable renderiza normalmente (tabela vazia ou estado vazio)",
      "isError nao controla mais a renderizacao da tabela — Card de erro com AlertTriangle removido",
      "InstanceSummaryCards recebe array vazio sem crash quando API offline",
      "Botao 'Tentar novamente' nao aparece por erro de negocio — so por falha de rede real"
    ],
    "dependencies": [
      "F-004"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-008",
    "name": "hub-instance-page-no-error-card",
    "description": "Refatorar whatsapp-instance.tsx: remover InstanceErrorCard como componente que substitui a pagina inteira. Erros de negocio (instancia nao encontrada, API offline) devem ser tratados inline. useActionState deve interpretar result.ok ao inves de ApiError status codes (429, 409).",
    "status": "passing",
    "priority": 8,
    "completed_at": "2026-02-17T15:30:00Z",
    "tests": [
      "InstanceErrorCard removida como componente inteiro que substitui a pagina",
      "Quando instancia nao encontrada (ok: false, error: 'instance_not_found'), exibe mensagem inline com link para voltar",
      "Quando API offline (ok: false, error: 'api_offline'), exibe mensagem inline com retry",
      "useActionState interpreta { ok: false, error: 'cooldown_active', retryAfterMs } ao inves de ApiError(429)",
      "useActionState interpreta { ok: false, error: 'retries_exhausted' } ao inves de ApiError(409)",
      "Tabs (status, qr, settings) sempre renderizam — nao sao substituidas por card de erro"
    ],
    "dependencies": [
      "F-004",
      "F-005"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-009",
    "name": "hub-qr-component-resilient",
    "description": "Refatorar instance-qr.tsx: QR falha (ok: false) gera mensagem inline com botao retry (nao tela de erro). Se instancia ja estiver 'open', aba QR mostra 'Instancia ja vinculada' com numero do telefone. Estado 'exhausted' mostra botao 'Recomecar' que reseta tentativas sem recarregar pagina.",
    "status": "pending",
    "priority": 9,
    "tests": [
      "Quando qr query retorna { ok: false, error: 'qr_unavailable' }, exibe mensagem inline com botao retry (nao tela de erro completa)",
      "Se instancia ja estiver state 'open', aba QR mostra 'Instancia ja vinculada' com profileName/owner",
      "Estado 'exhausted' mostra botao 'Recomecar' que reseta attempts para 0 e volta para state 'idle'",
      "Nao pede para recarregar a pagina em nenhum cenario",
      "Limite de 5 tentativas mantido"
    ],
    "dependencies": [
      "F-004"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-010",
    "name": "hub-settings-form-resilient",
    "description": "Refatorar instance-settings-form.tsx para interpretar envelope ApiResult. Quando settings query retorna ok: false, mostrar mensagem inline (nao crash). Quando mutation retorna ok: false, mostrar toast com mensagem amigavel.",
    "status": "pending",
    "priority": 10,
    "tests": [
      "Quando settings query retorna null (ok: false), form exibe mensagem 'Configuracoes indisponiveis' ao inves de crash",
      "Quando mutation retorna { ok: false, error: 'settings_update_failed' }, toast exibe 'Falha ao salvar configuracoes'",
      "Quando settings carregam com sucesso, form popula normalmente",
      "isError do React Query nao controla renderizacao — so falha de rede real gera erro"
    ],
    "dependencies": [
      "F-004",
      "F-005"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-011",
    "name": "hub-delete-flow-resilient",
    "description": "Refatorar os fluxos de delete em whatsapp.tsx e whatsapp-instance.tsx para interpretar ApiResult. Quando delete retorna ok: false, mostrar toast com mensagem amigavel ao inves de entrar em onError.",
    "status": "pending",
    "priority": 11,
    "tests": [
      "Em whatsapp.tsx, handleDelete verifica result.ok e mostra toast amigavel quando ok: false",
      "Em whatsapp-instance.tsx, handleDelete verifica result.ok e mostra toast amigavel quando ok: false",
      "Delete com sucesso (ok: true) navega e mostra toast de sucesso normalmente",
      "onError so dispara por falha de rede real (backbone inacessivel)"
    ],
    "dependencies": [
      "F-005"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  },
  {
    "id": "F-012",
    "name": "smoke-test-end-to-end",
    "description": "Validacao final: verificar que nenhuma rota do modulo Evolution retorna HTTP 4xx/5xx. Verificar que o hub nunca entra em isError por erro de negocio. Confirmar que todos os cenarios da tabela do PRP estao cobertos.",
    "status": "blocked",
    "priority": 12,
    "tests": [
      "curl em todas as rotas do modulo Evolution com cenarios de erro retorna HTTP 200",
      "Hub carrega pagina /conectividade/whatsapp sem crash mesmo com Evolution API offline",
      "Hub carrega pagina /conectividade/whatsapp/:name sem crash para instancia inexistente",
      "Fluxo completo: criar instancia -> ver status -> gerar QR -> configurar settings funciona end-to-end",
      "Tabela de cenarios do PRP (secao 1) 100% coberta"
    ],
    "dependencies": [
      "F-001",
      "F-002",
      "F-003",
      "F-004",
      "F-005",
      "F-006",
      "F-007",
      "F-008",
      "F-009",
      "F-010",
      "F-011"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\apps\\backbone\\milestones\\05-evolution-failsafe\\PRP.md"
  }
]
