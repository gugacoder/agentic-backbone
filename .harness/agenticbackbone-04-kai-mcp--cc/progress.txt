# Progress — 04-kai-mcp

## Current Status
F-002 concluída. McpServerConfig interface + mcpServers em KaiAgentOptions + export no index.ts. 2/8 features complete.

## Specs Path
D:\sources\codr.studio\cia-prime-care\agentic-backbone\packages\kai-sdk\milestones\04-kai-mcp

## Environment
- Stack: Node.js, TypeScript (ES2022, ESM), npm workspaces monorepo
- Package: packages/kai-sdk (@agentic-backbone/kai-sdk)
- Dev: npm run dev (tsc --watch) no workspace kai-sdk
- Build: npm run build --workspace=packages/kai-sdk
- Build backbone: npm run build --workspace=apps/backbone
- No test framework configured

## Features

- [x] F-001 MCP dependency — Adicionar @ai-sdk/mcp ao package.json
- [x] F-002 MCP types — McpServerConfig interface + mcpServers em KaiAgentOptions
- [ ] F-003 MCP client lifecycle — Criar/fechar MCP clients em runKaiAgent()
- [ ] F-004 Tool merging with priority — Mergear MCP tools com codingTools (coding tem prioridade)
- [ ] F-005 Graceful failure — Falha de conexão emite warning e continua
- [ ] F-006 mcp_connected event — Novo evento tipado em KaiAgentEvent
- [ ] F-007 Backbone KAI provider integration — Propagar mcpServers no provider
- [ ] F-008 Build validation — Build completo sem erros (kai-sdk + backbone)

## Architecture Decisions

1. **Única dependência nova**: @ai-sdk/mcp — usar createMCPClient(), sem implementação MCP custom
2. **Lifecycle**: MCP clients criados 1x no início de runKaiAgent(), fechados no finally block
3. **Prioridade de tools**: codingTools > MCP tools (spread: { ...mcpTools, ...codingTools })
4. **Graceful degradation**: Server indisponível → console.warn + continua sem ele
5. **Sem reconexão automática**: Se um server cair mid-session, tools dele param de funcionar
6. **Sem OAuth**: Apenas HTTP com headers fixos e stdio
7. **Sem MCP resources/prompts**: Apenas tools do protocolo MCP

## Files to Modify

### packages/kai-sdk/
- `package.json` — adicionar @ai-sdk/mcp dependency ✅
- `src/types.ts` — McpServerConfig, mcpServers em KaiAgentOptions ✅
- `src/agent.ts` — MCP client lifecycle, tool merging, event emission
- `src/index.ts` — exportar McpServerConfig ✅

### apps/backbone/
- `src/agent/providers/kai.ts` — propagar mcpServers para runKaiAgent()

## Session Notes
- Session 1 (Initializer): Harness criado para onda 04-kai-mcp. 8 features, PRP único e bem definido.
- Session 2 (CC): F-001 implementada. @ai-sdk/mcp@^1.0.21 adicionado.
- Session 3 (CC): F-002 implementada. McpServerConfig interface com transport union (http|stdio), mcpServers opcional em KaiAgentOptions, tipo exportado no index.ts. Build passa limpo. Próxima: F-003 MCP client lifecycle.
