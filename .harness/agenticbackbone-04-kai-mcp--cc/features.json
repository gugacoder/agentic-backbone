[
  {
    "id": "F-001",
    "name": "MCP dependency",
    "description": "Adicionar @ai-sdk/mcp como dependência no package.json do kai-sdk e verificar que instala corretamente",
    "status": "passing",
    "priority": 1,
    "tests": [
      "@ai-sdk/mcp aparece em dependencies no packages/kai-sdk/package.json",
      "npm install completa sem erros no workspace",
      "import { createMCPClient } from '@ai-sdk/mcp' resolve sem erros de TypeScript"
    ],
    "dependencies": [],
    "completed_at": "2026-02-16",
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-002",
    "name": "MCP types",
    "description": "Definir McpServerConfig interface e adicionar campo mcpServers opcional em KaiAgentOptions. Exportar os tipos no index.ts",
    "status": "passing",
    "completed_at": "2026-02-16",
    "priority": 2,
    "tests": [
      "McpServerConfig interface existe em types.ts com campos: name (string), transport (union de http e stdio)",
      "Transport HTTP tem: type 'http', url (string), headers opcional (Record<string,string>)",
      "Transport stdio tem: type 'stdio', command (string), args opcional (string[])",
      "KaiAgentOptions.mcpServers é McpServerConfig[] opcional",
      "McpServerConfig exportado no index.ts do pacote",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-001"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-003",
    "name": "MCP client lifecycle",
    "description": "Implementar criação de MCP clients no início de runKaiAgent() e fechamento no finally block. Usar createMCPClient do @ai-sdk/mcp para cada entry em mcpServers",
    "status": "failing",
    "priority": 3,
    "tests": [
      "Para cada entry em options.mcpServers, createMCPClient é chamado com o transport configurado",
      "client.tools() é chamado para obter as ferramentas de cada server",
      "Todos os MCP clients são fechados via client.close() em um finally block ao final de runKaiAgent()",
      "Se mcpServers não é passado ou é array vazio, nenhum client MCP é criado (comportamento idêntico ao atual)",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-001",
      "F-002"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-004",
    "name": "Tool merging with priority",
    "description": "Mergear ferramentas MCP com codingTools no streamText(). CodingTools têm prioridade — se um MCP server expõe uma tool com mesmo nome, a codingTool prevalece",
    "status": "blocked",
    "priority": 4,
    "tests": [
      "Tools MCP são mergeadas com codingTools e passadas ao streamText()",
      "Merge usa spread order: { ...allMcpTools, ...codingTools } para que codingTools sobrescrevam conflitos",
      "Sem MCP tools, streamText recebe apenas codingTools (comportamento idêntico)",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-003"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-005",
    "name": "Graceful failure",
    "description": "Se um MCP server não estiver disponível ou falhar ao conectar, emitir warning via console.warn e continuar sem ele. Timeout de conexão de 10 segundos",
    "status": "blocked",
    "priority": 5,
    "tests": [
      "Se createMCPClient falha (server indisponível), erro é capturado com try/catch",
      "Warning é emitido via console.warn com nome do server e mensagem de erro",
      "Execução continua normalmente com os demais servers e codingTools",
      "Se TODOS os servers falharem, agente roda apenas com codingTools (sem crash)",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-003"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-006",
    "name": "mcp_connected event",
    "description": "Adicionar evento mcp_connected em KaiAgentEvent e emiti-lo após todos os MCP clients conectarem, antes do primeiro streamText(). Lista os nomes dos servers conectados com sucesso",
    "status": "blocked",
    "priority": 6,
    "tests": [
      "KaiAgentEvent union inclui { type: 'mcp_connected'; servers: string[] }",
      "Evento é emitido (yield) após fase de conexão MCP e antes de streamText()",
      "servers contém apenas os nomes dos servers que conectaram com sucesso",
      "Se nenhum MCP server é configurado, evento NÃO é emitido",
      "Se servers são configurados mas todos falham, evento é emitido com array vazio",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-003",
      "F-005"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-007",
    "name": "Backbone KAI provider integration",
    "description": "Atualizar o provider KAI no Backbone (providers/kai.ts) para propagar mcpServers das options para runKaiAgent(). Converter formato Record do Backbone para McpServerConfig[] do SDK",
    "status": "blocked",
    "priority": 7,
    "tests": [
      "providers/kai.ts passa mcpServers para runKaiAgent() quando disponível nas options",
      "Conversão de Record<string, unknown> (formato Backbone) para McpServerConfig[] (formato SDK) funciona",
      "Se mcpServers não está nas options, não é passado (backward compatible)",
      "npm run build --workspace=apps/backbone compila sem erros",
      "npm run build --workspace=packages/kai-sdk compila sem erros"
    ],
    "dependencies": [
      "F-002",
      "F-003"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  },
  {
    "id": "F-008",
    "name": "Build validation",
    "description": "Validação final: build completo do workspace kai-sdk e backbone sem erros. Verificar que exports públicos estão corretos e tipos são acessíveis",
    "status": "blocked",
    "priority": 8,
    "tests": [
      "npm run build --workspace=packages/kai-sdk passa sem erros",
      "npm run build --workspace=apps/backbone passa sem erros",
      "McpServerConfig é exportado de @agentic-backbone/kai-sdk",
      "KaiAgentOptions inclui mcpServers no tipo exportado",
      "mcp_connected é tipo válido em KaiAgentEvent"
    ],
    "dependencies": [
      "F-001",
      "F-002",
      "F-003",
      "F-004",
      "F-005",
      "F-006",
      "F-007"
    ],
    "prp_path": "D:\\sources\\codr.studio\\cia-prime-care\\agentic-backbone\\packages\\kai-sdk\\milestones\\04-kai-mcp\\PRP.md"
  }
]
