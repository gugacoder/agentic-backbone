# Progress — agenticbackbone-10-kai-provider-registry

## Current Status
Harness inicializado. 7 features decompostas do PRP. Nenhuma feature implementada ainda.

## Specs Path
D:\sources\codr.studio\cia-prime-care\agentic-backbone\apps\backbone\milestones\10-kai-provider-registry

## Environment
- Stack: Node.js, TypeScript (ES2022, ESM), npm workspaces monorepo
- Package: packages/kai-sdk (@agentic-backbone/kai-sdk)
- Build: npm run build --workspace=packages/kai-sdk
- Dev: npm run dev (from packages/kai-sdk — tsc --watch)
- No test framework configured

## Features

- [ ] F-001: provider-registry-module — Criar providers.ts com createKaiProviderRegistry()
- [ ] F-002: types-model-aliases — Adicionar modelAliases em KaiAgentOptions
- [ ] F-003: agent-integration — Refatorar agent.ts para usar registry
- [ ] F-004: compaction-integration — Refatorar compaction.ts para aceitar registry
- [ ] F-005: structured-integration — Refatorar structured.ts para aceitar registry
- [ ] F-006: exports-index — Exportar registry no index.ts
- [ ] F-007: build-verification — Build completo sem erros e sem regressões

## Architecture Decisions

1. **Single registry per session**: Um ProviderRegistry criado por sessão do agente, reutilizado por compaction e structured outputs
2. **Backward compatibility**: Módulos que aceitam providers como opcional mantêm fallback interno (criam provider se não recebem)
3. **Aliases opcionais**: DEFAULT_ALIASES (fast, balanced, strong) funcionam sem configuração; customizados sobrescrevem defaults
4. **OpenRouter only**: Este PRP NÃO adiciona multi-provider — apenas centraliza OpenRouter
5. **No new dependencies**: createProviderRegistry do Vercel AI SDK NÃO é utilizado diretamente (o PRP usa um wrapper customizado mais simples); tudo usa pacotes já existentes

## Provider Duplication Map (estado atual)

| Arquivo | Linhas | Instância |
|---|---|---|
| agent.ts | 71-75 | Principal — cria openrouter para o agente |
| agent.ts | 257, 269 | openrouter(options.model) — resolução de modelo |
| compaction.ts | 142-146 | Compaction structured (generateObject) |
| compaction.ts | 199-203 | Compaction fallback (generateText) |
| structured.ts | 17-21 | kaiGenerateObject |
| structured.ts | 37-41 | kaiStreamObject |

Total: 5 instâncias de createOpenAICompatible (6 usos de openrouter())

## Session Notes

Session 1 (Initializer): Harness criado para onda 10-kai-provider-registry. 7 features decompostas do PRP. Identificada duplicação em 5 pontos (mais que os 2 documentados no PRP — structured.ts também duplica).
